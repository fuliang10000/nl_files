## 王者系统上线流程

**后台上线**

- 服务端上线

1. 备份数据库
2. 备份server目录
3. ossfs卸载：sudo fusermount -u /srv/nginx/html/server/storage/app/public
4. 合并server项目staging分支到release分支，CI/CD自动发布到线上
5. 执行数据迁移、生成缓存等：php artisan config:cache && php artisan route:cache && php artisan view:cache && php artisan migrate --force
6. 修改权限 sudo chmod -R 0755 /srv/nginx/html/server
7. 修改权限 sudo chmod -R 0777 /srv/nginx/html/server/storage/logs
8. 重启服务：sudo docker compose restart
9. 重新挂载ossfs：sudo ossfs wangzhexitong /srv/nginx/html/server/storage/app/public -o url=http://oss-cn-chengdu-internal.aliyuncs.com -o allow_other -o nonempty

- 后台前端上线

1. 前端编译好dist-new
2. 覆盖掉/srv/nginx/html/admin/dist-new

**客户端上线**

- APP上线

1. 打包最新版本APP安装包
2. 新版本安装包上传到阿里云OSS/wangzhexitong/app-release下面
3. 修改/srv/nginx/html/app-release/index.html中APP下载链接
4. 数据表app_versions插入最新版本数据